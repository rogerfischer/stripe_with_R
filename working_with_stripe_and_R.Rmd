---
title: "Working with Stripe Data and R"
author: "Roger Fischer"
date: "March 17, 2015"
---

# Working with Stripe Data and R

I recently started working with [R](http://www.r-project.org/ "The R Project for Statistical Computing"). As we use [Stripe](https://stripe.com) as one of our payment providers, I thought it might be interesting to use Stripe's CSV files and R to answer some of the questions every SaaS startup needs to know.


## How many new, recurring and lost users do we have per week?
As we have a weekly meeting where we discuss our numbers, it would be best to get the numbers per week. So I decided to start with the question of how many new and recurring customer we have, as well as how many customers we loose per week.

To start I only wanted to have a table that shows the week and below the numbers for lost, new and recurring customers.
In future posts, I plan to show different aspects like financial data or add visual features like plots. 



## The CSV file from Stripe
If you are a Stripe user you can download the payments.csv file directly from [https://dashboard.stripe.com/payments](https://dashboard.stripe.com/payments). 
Below are the columns, or variables in R speak, available in the CSV file:

```r
> names(raw_data)
 [1] "id"                         "Description"               
 [3] "Created..UTC."              "Amount"                    
 [5] "Amount.Refunded"            "Currency"                  
 [7] "Converted.Amount"           "Converted.Amount.Refunded" 
 [9] "Fee"                        "Tax"                       
[11] "Converted.Currency"         "Mode"                      
[13] "Status"                     "Statement.Descriptor"      
[15] "Customer.ID"                "Customer.Description"      
[17] "Customer.Email"             "Captured"                  
[19] "Card.ID"                    "Card.Last4"                
[21] "Card.Brand"                 "Card.Funding"              
[23] "Card.Exp.Month"             "Card.Exp.Year"             
[25] "Card.Name"                  "Card.Address.Line1"        
[27] "Card.Address.Line2"         "Card.Address.City"         
[29] "Card.Address.State"         "Card.Address.Country"      
[31] "Card.Address.Zip"           "Card.Issue.Country"        
[33] "Card.Fingerprint"           "Card.CVC.Status"           
[35] "Card.AVS.Zip.Status"        "Card.AVS.Line1.Status"     
[37] "Disputed.Amount"            "Dispute.Status"            
[39] "Dispute.Reason"             "Dispute.Date..UTC."        
[41] "Dispute.Evidence.Due..UTC." "Invoice.ID"                
[43] "Payment.Source.Type"  
```
We will only use a few of them for our purpose, but it's good to see what is available. 
Besides the payments.csv, there are also CSV files available for customers and for transfers. We may be discuss their respective merit in future posts.

## Installing R and R Studio
To play with the [R script](https://github.com/rogerfischer/stripe_with_R/blob/master/stripe_weekly_new_recurring_lost.R) and your CSV file, you need however first to [download](http://stat.ethz.ch/CRAN/) and install R. 
I also highly recommend to use [R Studio](http://www.rstudio.com/products/rstudio/download/). 
Once you have R Studio (or R on your Terminal/Shell) up and running, choose your working directory and set it in R Studio like this:
```r
setwd("your_working_directory")
```. 
If you want to check that you are where you want to be, you can use
```r
getwd()
```
The [R script](https://github.com/rogerfischer/stripe_with_R/blob/master/stripe_weekly_new_recurring_lost.R) and your CSV file should be in your working directory if you want to run this "as is".

At the end a new CSV file called "new_recurring_lost.csv"" will be available in your working directory.
If you dont want to create this CSV file, you can just outcomment the last line:
```r
write.table(user_types_by_period, file = "new_recurring_lost.csv", row.names = FALSE, sep = "\t")
```












